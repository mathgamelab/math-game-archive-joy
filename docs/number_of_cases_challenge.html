

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ² ê²½ìš°ì˜ ìˆ˜ ì±Œë¦°ì§€!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .game-container {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .character {
            transition: transform 0.3s ease;
        }
        
        .character:hover {
            transform: scale(1.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-option {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            transition: all 0.3s ease;
        }
        
        .btn-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(168, 237, 234, 0.3);
        }
        
        .btn-option.selected {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: 3px solid #667eea;
        }
        
        .modal {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .result-box {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .explanation-box {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
    </style>
</head>
<body class="p-4">
    <!-- ê²Œì„ ì„¤ëª… ëª¨ë‹¬ -->
    <div id="introModal" class="fixed inset-0 modal flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-4 md:p-8 max-w-2xl w-full shadow-2xl max-h-screen overflow-y-auto">
            <h2 class="text-2xl md:text-3xl font-bold text-center mb-4 md:mb-6 text-purple-700">ğŸ² ê²½ìš°ì˜ ìˆ˜ ì±Œë¦°ì§€!</h2>
            <div class="space-y-3 md:space-y-4 text-gray-700">
                <p class="text-base md:text-lg">ì•ˆë…•í•˜ì„¸ìš”! ê²½ìš°ì˜ ìˆ˜ë¥¼ ì¬ë¯¸ìˆê²Œ ë°°ì›Œë³´ëŠ” ê²Œì„ì…ë‹ˆë‹¤.</p>
                <div class="bg-blue-50 p-3 md:p-4 rounded-lg">
                    <h3 class="font-semibold mb-2 text-sm md:text-base">ê²Œì„ ë°©ë²•:</h3>
                    <ul class="list-disc list-inside space-y-1 text-xs md:text-sm">
                        <li>6ëª…ì˜ ìºë¦­í„° ì¤‘ì—ì„œ ëª‡ ëª…ì„ ì„ íƒí• ì§€ ì •í•˜ì„¸ìš”</li>
                        <li>ì–´ë–»ê²Œ ë°°ì—´í• ì§€ ì„ íƒí•˜ì„¸ìš” (í•œ ì¤„ ì„¸ìš°ê¸° vs ëŒ€í‘œ ë½‘ê¸°)</li>
                        <li>ì¤‘ë³µ í—ˆìš© ì—¬ë¶€ë¥¼ ì„ íƒí•˜ì„¸ìš”</li>
                        <li>ëª©í‘œ ìˆ«ìì™€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ ì°¾ì•„ë³´ì„¸ìš”!</li>
                    </ul>
                </div>
                <div class="bg-yellow-50 p-3 md:p-4 rounded-lg">
                    <p class="font-semibold mb-2 text-sm md:text-base">ì¤‘ë³µìˆœì—´ê³¼ ì¤‘ë³µì¡°í•©ì„ ë°°ì› ë‚˜ìš”?</p>
                    <div class="flex flex-col sm:flex-row gap-2 md:gap-4">
                        <button onclick="setLevel(true)" class="btn-primary text-white px-4 md:px-6 py-2 rounded-full font-semibold text-sm md:text-base">ë„¤, ë°°ì› ì–´ìš”!</button>
                        <button onclick="setLevel(false)" class="bg-gray-400 text-white px-4 md:px-6 py-2 rounded-full font-semibold hover:bg-gray-500 text-sm md:text-base">ì•„ì§ ì•ˆ ë°°ì› ì–´ìš”</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto">
        <!-- ë©”ì¸ ê²Œì„ ì»¨í…Œì´ë„ˆ -->
        <div class="game-container p-4 md:p-8">
            <!-- í—¤ë” -->
            <div class="text-center mb-6">
                <h1 class="text-2xl md:text-4xl font-bold text-purple-800 mb-4">ğŸ² ê²½ìš°ì˜ ìˆ˜ ì±Œë¦°ì§€!</h1>
                <div class="flex flex-col sm:flex-row justify-center items-center gap-2 md:gap-4">
                    <div class="bg-white rounded-2xl px-3 md:px-6 py-3 shadow-lg">
                        <span class="font-semibold text-purple-700 text-sm md:text-lg">ëª©í‘œ ìˆ«ì: </span>
                        <span id="targetNumber" class="text-xl md:text-2xl font-bold text-orange-600">?</span>
                    </div>
                    <div class="bg-white rounded-2xl px-3 md:px-6 py-3 shadow-lg">
                        <span class="font-semibold text-purple-700 text-sm md:text-lg">ë¼ìš´ë“œ: </span>
                        <span id="currentRound" class="text-xl md:text-2xl font-bold text-blue-600">1/10</span>
                    </div>
                    <div class="bg-white rounded-2xl px-3 md:px-6 py-3 shadow-lg">
                        <span class="font-semibold text-purple-700 text-sm md:text-lg">ì ìˆ˜: </span>
                        <span id="score" class="text-xl md:text-2xl font-bold text-green-600">0</span>
                    </div>

                </div>
            </div>

            <!-- ìºë¦­í„°ë“¤ -->
            <div class="mb-6">
                <div id="charactersContainer" class="flex justify-center gap-2 md:gap-4 flex-wrap">
                    <p class="text-center text-gray-500">ì „ì²´ ì¸ì›ì„ ì„ íƒí•˜ë©´ ì¹œêµ¬ë“¤ì´ ë‚˜íƒ€ë‚˜ìš”!</p>
                </div>
            </div>

            <!-- ì„ íƒ ì˜µì…˜ë“¤ -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <!-- ì„ íƒ 1: ì „ì²´ ëª‡ ëª… ì¤‘ì—ì„œ? -->
                <div class="bg-white rounded-xl p-4 shadow-lg">
                    <h3 class="text-base font-semibold mb-3 text-center text-purple-700">ì „ì²´ ëª‡ ëª… ì¤‘ì—ì„œ? ğŸ‘¥</h3>
                    <div class="grid grid-cols-3 gap-1">
                        <button onclick="selectTotal(3)" class="btn-option text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="total">3ëª…</button>
                        <button onclick="selectTotal(4)" class="btn-option text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="total">4ëª…</button>
                        <button onclick="selectTotal(5)" class="btn-option text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="total">5ëª…</button>
                        <button onclick="selectTotal(6)" class="btn-option text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="total">6ëª…</button>
                        <button onclick="selectTotal(7)" class="btn-option text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="total">7ëª…</button>
                        <button onclick="selectTotal(8)" class="btn-option text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="total">8ëª…</button>
                    </div>
                </div>

                <!-- ì„ íƒ 2: ê·¸ ì¤‘ ëª‡ ëª…ì„ ì„ íƒí• ê¹Œ? -->
                <div class="bg-white rounded-xl p-4 shadow-lg">
                    <h3 class="text-base font-semibold mb-3 text-center text-purple-700">ê·¸ ì¤‘ ëª‡ ëª…ì„ ì„ íƒí• ê¹Œ? ğŸ¤”</h3>
                    <div id="countOptions" class="grid grid-cols-2 gap-1">
                        <p class="text-center text-gray-500 col-span-2 text-xs">ë¨¼ì € ì „ì²´ ì¸ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                    </div>
                </div>

                <!-- ì„ íƒ 3: ì–´ë–»ê²Œ ë°°ì—´í• ê¹Œ? -->
                <div class="bg-white rounded-xl p-4 shadow-lg">
                    <h3 class="text-base font-semibold mb-3 text-center text-purple-700">ì–´ë–»ê²Œ ë°°ì—´í• ê¹Œ? ğŸ¯</h3>
                    <div class="space-y-2">
                        <button onclick="selectArrangement('permutation')" class="btn-option w-full text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="arrangement">í•œ ì¤„ ì„¸ìš°ê¸°<br><small>(ìˆœì„œ ì¤‘ìš”)</small></button>
                        <button onclick="selectArrangement('combination')" class="btn-option w-full text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="arrangement">ëŒ€í‘œ ë½‘ê¸°<br><small>(ìˆœì„œ ë¬´ê´€)</small></button>
                    </div>
                </div>

                <!-- ì„ íƒ 4: ì¤‘ë³µì´ ê°€ëŠ¥í• ê¹Œ? -->
                <div class="bg-white rounded-xl p-4 shadow-lg">
                    <h3 class="text-base font-semibold mb-3 text-center text-purple-700">ì¤‘ë³µì´ ê°€ëŠ¥í• ê¹Œ? ğŸ”„</h3>
                    <div class="space-y-2">
                        <button onclick="selectDuplication(false)" class="btn-option w-full text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="duplication">ì¤‘ë³µ ë¶ˆê°€ëŠ¥<br><small>(í•œ ë²ˆë§Œ ì„ íƒ)</small></button>
                        <button onclick="selectDuplication(true)" class="btn-option w-full text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="duplication" id="duplicateBtn" style="display:none;">ì¤‘ë³µ í—ˆìš©<br><small>(ì—¬ëŸ¬ ë²ˆ ì„ íƒ)</small></button>
                    </div>
                </div>
            </div>

            <!-- ê²°ê³¼ í™•ì¸ ë²„íŠ¼ -->
            <div class="text-center mb-6">
                <button onclick="checkResult()" id="checkBtn" class="btn-primary text-white px-8 md:px-12 py-3 md:py-4 rounded-2xl text-lg md:text-xl font-bold shadow-lg w-full max-w-xs" disabled>
                    ê²°ê³¼ í™•ì¸! ğŸ‰
                </button>
            </div>

            <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
            <div id="resultArea" class="hidden">
                <div class="result-box p-6 mb-6">
                    <h3 class="text-2xl font-bold text-center mb-4 text-purple-800">ê³„ì‚° ê²°ê³¼ ğŸ“Š</h3>
                    <div id="resultContent" class="text-center space-y-4">
                        <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <div class="text-center mt-8 text-white">
        <p class="text-lg">í–‰ë³µí•œ ìˆ˜í•™, í•¨ê»˜ ë§Œë“¤ì–´ìš” ğŸ˜Š</p>
        <p class="text-sm opacity-80">Â© í–‰ë³µí•œìœ¤ìŒ¤ | <a href="https://blog.naver.com/happy_yoonssam" class="underline hover:text-yellow-300" target="_blank">https://blog.naver.com/happy_yoonssam</a></p>
    </div>

    <script>
        let gameState = {
            total: null,
            count: null,
            arrangement: null,
            duplication: null,
            targetNumber: null,
            score: 0,
            advancedLevel: false,
            currentRound: 1,
            totalRounds: 10,
            startTime: null,
            gameTimer: null
        };

        const animals = ['ğŸ±', 'ğŸ¶', 'ğŸ°', 'ğŸ¼', 'ğŸ¦Š', 'ğŸ¸', 'ğŸ¨', 'ğŸ¯'];

        function setLevel(advanced) {
            gameState.advancedLevel = advanced;
            document.getElementById('introModal').style.display = 'none';
            
            // ê²Œì„ ì‹œì‘ ì‹œ ëª©í‘œ ìˆ«ì ìƒì„±
            generateTarget();
            
            // ê²Œì„ íƒ€ì´ë¨¸ ì‹œì‘
            startGameTimer();
            
            // ê³ ê¸‰ ë ˆë²¨ì´ë©´ ì¤‘ë³µ í—ˆìš© ë²„íŠ¼ í‘œì‹œ, ì•„ë‹ˆë©´ ì¤‘ë³µ ë¶ˆê°€ëŠ¥ ìë™ ì„ íƒ
            if (advanced) {
                document.getElementById('duplicateBtn').style.display = 'block';
            } else {
                // ì´ˆê¸‰ìëŠ” ì¤‘ë³µ ë¶ˆê°€ëŠ¥ë§Œ ê°€ëŠ¥í•˜ë„ë¡ ìë™ ì„ íƒ ë° ë¹„í™œì„±í™”
                gameState.duplication = false;
                const noDuplicateBtn = document.querySelector('[onclick="selectDuplication(false)"]');
                noDuplicateBtn.classList.add('selected');
                noDuplicateBtn.style.opacity = '0.7';
                noDuplicateBtn.style.pointerEvents = 'none';
                noDuplicateBtn.innerHTML = 'ì¤‘ë³µ ë¶ˆê°€ëŠ¥<br><small>(ê¸°ë³¸ ì„¤ì •)</small>';
            }
        }

        function startGameTimer() {
            gameState.startTime = Date.now();
            gameState.gameTimer = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            // íƒ€ì´ë¨¸ëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œë§Œ ì‹¤í–‰ (í™”ë©´ì— í‘œì‹œí•˜ì§€ ì•ŠìŒ)
        }

        function stopGameTimer() {
            if (gameState.gameTimer) {
                clearInterval(gameState.gameTimer);
                gameState.gameTimer = null;
            }
        }

        function pauseGameTimer() {
            if (gameState.gameTimer) {
                clearInterval(gameState.gameTimer);
                gameState.gameTimer = null;
            }
        }

        function resumeGameTimer() {
            if (!gameState.gameTimer) {
                gameState.gameTimer = setInterval(updateTimer, 1000);
            }
        }

        function generateTarget() {
            // ê° ìœ í˜•ë³„ë¡œ ê°€ëŠ¥í•œ ìˆ«ìë“¤ì„ ë¶„ë¥˜í•˜ì—¬ ì €ì¥
            let combinationTargets = [];
            let permutationTargets = [];
            let dupPermutationTargets = [];
            let dupCombinationTargets = [];
            
            // 3ëª…ë¶€í„° 8ëª…ê¹Œì§€ì˜ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ ê³„ì‚°
            for (let n = 3; n <= 8; n++) {
                for (let r = 1; r <= n; r++) {
                    // ì¡°í•© C(n,r)
                    const combResult = combination(n, r);
                    if (combResult > 0) {
                        combinationTargets.push({
                            value: combResult,
                            type: 'combination',
                            n: n, r: r
                        });
                    }
                    
                    // ìˆœì—´ P(n,r)
                    const permResult = permutation(n, r);
                    if (permResult > 0) {
                        permutationTargets.push({
                            value: permResult,
                            type: 'permutation',
                            n: n, r: r
                        });
                    }
                    
                    if (gameState.advancedLevel) {
                        // ì¤‘ë³µìˆœì—´ n^r
                        const dupPermResult = Math.pow(n, r);
                        if (dupPermResult > 0) {
                            dupPermutationTargets.push({
                                value: dupPermResult,
                                type: 'dupPermutation',
                                n: n, r: r
                            });
                        }
                        
                        // ì¤‘ë³µì¡°í•© H(n,r) = C(n+r-1, r)
                        const dupCombResult = combination(n + r - 1, r);
                        if (dupCombResult > 0) {
                            dupCombinationTargets.push({
                                value: dupCombResult,
                                type: 'dupCombination',
                                n: n, r: r
                            });
                        }
                    }
                }
            }
            
            // ê° ìœ í˜•ë³„ë¡œ ì •ë ¬
            combinationTargets.sort((a, b) => a.value - b.value);
            permutationTargets.sort((a, b) => a.value - b.value);
            dupPermutationTargets.sort((a, b) => a.value - b.value);
            dupCombinationTargets.sort((a, b) => a.value - b.value);
            
            const currentRound = gameState.currentRound;
            let selectedTarget;
            
            // ë¼ìš´ë“œì— ë”°ë¥¸ ìœ í˜• ì„ íƒ (ê³¨ê³ ë£¨ ë“±ì¥í•˜ë„ë¡)
            let targetType;
            if (gameState.advancedLevel) {
                // ê³ ê¸‰ ëª¨ë“œ: 4ê°€ì§€ ìœ í˜•ì„ ìˆœí™˜
                const typeIndex = (currentRound - 1) % 4;
                const types = ['combination', 'permutation', 'dupPermutation', 'dupCombination'];
                targetType = types[typeIndex];
            } else {
                // ì´ˆê¸‰ ëª¨ë“œ: ì¡°í•©ê³¼ ìˆœì—´ë§Œ ë²ˆê°ˆì•„
                targetType = (currentRound % 2 === 1) ? 'combination' : 'permutation';
            }
            
            // ì„ íƒëœ ìœ í˜•ì˜ ìˆ«ìë“¤ ê°€ì ¸ì˜¤ê¸°
            let availableTargets = [];
            switch(targetType) {
                case 'combination':
                    availableTargets = combinationTargets;
                    break;
                case 'permutation':
                    availableTargets = permutationTargets;
                    break;
                case 'dupPermutation':
                    availableTargets = dupPermutationTargets;
                    break;
                case 'dupCombination':
                    availableTargets = dupCombinationTargets;
                    break;
            }
            
            if (availableTargets.length === 0) {
                // í•´ë‹¹ ìœ í˜•ì— ìˆ«ìê°€ ì—†ìœ¼ë©´ ì¡°í•©ì—ì„œ ì„ íƒ
                availableTargets = combinationTargets;
            }
            
            // ë¼ìš´ë“œì— ë”°ë¥¸ ë‚œì´ë„ ì¡°ì •
            let targetPool = [];
            const totalCount = availableTargets.length;
            
            if (currentRound <= 2) {
                // 1-2ë¼ìš´ë“œ: ê°€ì¥ ì‰¬ìš´ ìˆ«ìë“¤ (1~10 ë²”ìœ„)
                targetPool = availableTargets.filter(target => target.value >= 1 && target.value <= 10);
                if (targetPool.length === 0) {
                    const count = Math.max(1, Math.floor(totalCount * 0.15));
                    targetPool = availableTargets.slice(0, count);
                }
            } else if (currentRound <= 4) {
                // 3-4ë¼ìš´ë“œ: ì ë‹¹í•œ ë‚œì´ë„ (10~50 ë²”ìœ„) - 7C3=35, 8C2=28, 6C3=20 ë“±
                targetPool = availableTargets.filter(target => target.value >= 10 && target.value <= 50);
                if (targetPool.length === 0) {
                    const startIndex = Math.floor(totalCount * 0.15);
                    const endIndex = Math.floor(totalCount * 0.45);
                    targetPool = availableTargets.slice(startIndex, endIndex);
                }
            } else if (currentRound <= 6) {
                // 5-6ë¼ìš´ë“œ: ì¤‘ê°„ ë‚œì´ë„ (30~100 ë²”ìœ„)
                targetPool = availableTargets.filter(target => target.value >= 30 && target.value <= 100);
                if (targetPool.length === 0) {
                    const startIndex = Math.floor(totalCount * 0.35);
                    const endIndex = Math.floor(totalCount * 0.70);
                    targetPool = availableTargets.slice(startIndex, endIndex);
                }
            } else if (currentRound <= 8) {
                // 7-8ë¼ìš´ë“œ: í° ìˆ«ìë“¤ (70~300 ë²”ìœ„)
                targetPool = availableTargets.filter(target => target.value >= 70 && target.value <= 300);
                if (targetPool.length === 0) {
                    const startIndex = Math.floor(totalCount * 0.60);
                    const endIndex = Math.floor(totalCount * 0.85);
                    targetPool = availableTargets.slice(startIndex, endIndex);
                }
            } else {
                // 9-10ë¼ìš´ë“œ: ê°€ì¥ í° ìˆ«ìë“¤ë§Œ - 200 ì´ìƒì˜ ì •ë§ í° ìˆ«ìë“¤
                // ë¨¼ì € 200 ì´ìƒì˜ ìˆ«ìë“¤ë§Œ í•„í„°ë§
                targetPool = availableTargets.filter(target => target.value >= 200);
                
                // 200 ì´ìƒì´ ì—†ìœ¼ë©´ 100 ì´ìƒìœ¼ë¡œ ì™„í™”
                if (targetPool.length === 0) {
                    targetPool = availableTargets.filter(target => target.value >= 100);
                }
                
                // ê·¸ë˜ë„ ì—†ìœ¼ë©´ ìƒìœ„ 5%ì—ì„œ ì„ íƒ
                if (targetPool.length === 0) {
                    const startIndex = Math.floor(totalCount * 0.95);
                    targetPool = availableTargets.slice(startIndex);
                }
                
                // ìµœì¢…ì ìœ¼ë¡œë„ ì—†ìœ¼ë©´ ì „ì²´ì—ì„œ ê°€ì¥ í° ìˆ«ìë“¤
                if (targetPool.length === 0) {
                    targetPool = availableTargets.slice(-Math.max(1, Math.floor(totalCount * 0.1)));
                }
            }
            
            // í•´ë‹¹ êµ¬ê°„ì—ì„œ ëœë¤í•˜ê²Œ ì„ íƒ
            if (targetPool.length === 0) {
                targetPool = availableTargets;
            }
            
            selectedTarget = targetPool[Math.floor(Math.random() * targetPool.length)];
            gameState.targetNumber = selectedTarget.value;
            document.getElementById('targetNumber').textContent = gameState.targetNumber;
        }

        function selectTotal(total) {
            if (gameState.total === total) {
                gameState.total = null;
                event.target.classList.remove('selected');
                updateCharacters();
                updateCountOptions();
            } else {
                gameState.total = total;
                updateButtonSelection('total', total);
                updateCharacters();
                updateCountOptions();
            }
            checkAllSelected();
        }

        function updateCharacters() {
            const container = document.getElementById('charactersContainer');
            
            if (!gameState.total) {
                container.innerHTML = '<p class="text-center text-gray-500">ì „ì²´ ì¸ì›ì„ ì„ íƒí•˜ë©´ ì¹œêµ¬ë“¤ì´ ë‚˜íƒ€ë‚˜ìš”!</p>';
                return;
            }
            
            let html = '';
            for (let i = 0; i < gameState.total; i++) {
                const isSelected = gameState.count && i < gameState.count;
                const opacity = isSelected ? 'opacity-100' : 'opacity-30';
                html += `<div class="character text-4xl md:text-6xl ${opacity} transition-opacity duration-300">${animals[i]}</div>`;
            }
            
            container.innerHTML = html;
        }

        function updateCountOptions() {
            const container = document.getElementById('countOptions');
            
            if (!gameState.total) {
                container.innerHTML = '<p class="text-center text-gray-500 col-span-2">ë¨¼ì € ì „ì²´ ì¸ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>';
                return;
            }
            
            let html = '';
            for (let i = 1; i <= gameState.total; i++) {
                html += `<button onclick="selectCount(${i})" class="btn-option text-purple-700 font-semibold py-2 rounded-lg text-xs" data-group="count">${i}ëª…</button>`;
            }
            
            container.innerHTML = html;
        }

        function selectCount(count) {
            if (gameState.count === count) {
                gameState.count = null;
                event.target.classList.remove('selected');
            } else {
                gameState.count = count;
                updateButtonSelection('count', count);
            }
            updateCharacters();
            checkAllSelected();
        }

        function selectArrangement(type) {
            if (gameState.arrangement === type) {
                gameState.arrangement = null;
                event.target.classList.remove('selected');
            } else {
                gameState.arrangement = type;
                updateButtonSelection('arrangement', type);
            }
            checkAllSelected();
        }

        function selectDuplication(allowed) {
            if (gameState.duplication === allowed) {
                gameState.duplication = null;
                event.target.classList.remove('selected');
            } else {
                gameState.duplication = allowed;
                updateButtonSelection('duplication', allowed);
            }
            checkAllSelected();
        }

        function updateButtonSelection(group, value) {
            // ê°™ì€ ê·¸ë£¹ì˜ ëª¨ë“  ë²„íŠ¼ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll(`[data-group="${group}"]`).forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // í´ë¦­ëœ ë²„íŠ¼ì— selected í´ë˜ìŠ¤ ì¶”ê°€
            event.target.classList.add('selected');
        }

        function checkAllSelected() {
            const allSelected = gameState.total !== null &&
                              gameState.count !== null && 
                              gameState.arrangement !== null && 
                              gameState.duplication !== null;
            
            document.getElementById('checkBtn').disabled = !allSelected;
            if (allSelected) {
                document.getElementById('checkBtn').classList.remove('opacity-50');
            } else {
                document.getElementById('checkBtn').classList.add('opacity-50');
            }
        }

        function factorial(n) {
            if (n <= 1) return 1;
            return n * factorial(n - 1);
        }

        function combination(n, r) {
            if (r > n) return 0;
            return factorial(n) / (factorial(r) * factorial(n - r));
        }

        function permutation(n, r) {
            if (r > n) return 0;
            return factorial(n) / factorial(n - r);
        }

        function calculateResult() {
            const n = gameState.total; // ì´ ìºë¦­í„° ìˆ˜
            const r = gameState.count;
            
            let result = 0;
            let formula = '';
            let explanation = '';
            
            if (gameState.arrangement === 'permutation') {
                if (gameState.duplication) {
                    // ì¤‘ë³µìˆœì—´
                    result = Math.pow(n, r);
                    formula = `${n}ì˜ ${r}ì œê³± = ${result}`;
                    explanation = `ì¤‘ë³µìˆœì—´: ${n}ëª… ì¤‘ì—ì„œ ${r}ëª…ì„ ìˆœì„œë¥¼ ê³ ë ¤í•˜ì—¬ ì¤‘ë³µì„ í—ˆìš©í•´ì„œ ì„ íƒ`;
                } else {
                    // ìˆœì—´
                    result = permutation(n, r);
                    formula = `P(${n},${r}) = ${n}!Ã·(${n}-${r})! = ${result}`;
                    explanation = `ìˆœì—´: ${n}ëª… ì¤‘ì—ì„œ ${r}ëª…ì„ ìˆœì„œë¥¼ ê³ ë ¤í•˜ì—¬ ì„ íƒ`;
                }
            } else {
                if (gameState.duplication) {
                    // ì¤‘ë³µì¡°í•©
                    result = combination(n + r - 1, r);
                    formula = `H(${n},${r}) = C(${n+r-1},${r}) = ${result}`;
                    explanation = `ì¤‘ë³µì¡°í•©: ${n}ëª… ì¤‘ì—ì„œ ${r}ëª…ì„ ìˆœì„œ ë¬´ê´€í•˜ê²Œ ì¤‘ë³µì„ í—ˆìš©í•´ì„œ ì„ íƒ`;
                } else {
                    // ì¡°í•©
                    result = combination(n, r);
                    formula = `C(${n},${r}) = ${n}!Ã·(${r}!Ã—(${n}-${r})!) = ${result}`;
                    explanation = `ì¡°í•©: ${n}ëª… ì¤‘ì—ì„œ ${r}ëª…ì„ ìˆœì„œ ë¬´ê´€í•˜ê²Œ ì„ íƒ`;
                }
            }
            
            return { result, formula, explanation };
        }

        function getTargetExplanation() {
            // ëª©í‘œ ìˆ«ìê°€ ì–´ë–»ê²Œ ë‚˜ì˜¨ ê²ƒì¸ì§€ ëª¨ë“  ê°€ëŠ¥í•œ ë°©ë²• ì°¾ê¸°
            const target = gameState.targetNumber;
            let possibleSolutions = [];
            
            // 3~8ëª… ë²”ìœ„ì—ì„œ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ ê³„ì‚°í•˜ì—¬ ì¼ì¹˜í•˜ëŠ” ê²ƒ ì°¾ê¸°
            for (let n = 3; n <= 8; n++) {
                for (let r = 1; r <= n; r++) {
                    // ì¡°í•© í™•ì¸
                    if (combination(n, r) === target) {
                        possibleSolutions.push(`C(${n},${r}) = ${target} (${n}ëª… ì¤‘ ${r}ëª…ì„ ìˆœì„œ ë¬´ê´€í•˜ê²Œ ì„ íƒ)`);
                    }
                    
                    // ìˆœì—´ í™•ì¸
                    if (permutation(n, r) === target) {
                        possibleSolutions.push(`P(${n},${r}) = ${target} (${n}ëª… ì¤‘ ${r}ëª…ì„ ìˆœì„œëŒ€ë¡œ ë°°ì—´)`);
                    }
                    
                    if (gameState.advancedLevel) {
                        // ì¤‘ë³µìˆœì—´ í™•ì¸
                        if (Math.pow(n, r) === target) {
                            possibleSolutions.push(`${n}ì˜ ${r}ì œê³± = ${target} (${n}ëª… ì¤‘ ${r}ëª…ì„ ì¤‘ë³µ í—ˆìš©í•˜ì—¬ ìˆœì„œëŒ€ë¡œ ë°°ì—´)`);
                        }
                        
                        // ì¤‘ë³µì¡°í•© í™•ì¸
                        if (combination(n + r - 1, r) === target) {
                            possibleSolutions.push(`H(${n},${r}) = ${target} (${n}ëª… ì¤‘ ${r}ëª…ì„ ì¤‘ë³µ í—ˆìš©í•˜ì—¬ ì„ íƒ)`);
                        }
                    }
                }
            }
            
            if (possibleSolutions.length === 0) {
                return "ê³„ì‚° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            }
            
            return possibleSolutions.join(" ë˜ëŠ” ");
        }

        function checkResult() {
            // íƒ€ì´ë¨¸ ì¼ì‹œì •ì§€
            pauseGameTimer();
            
            const calculation = calculateResult();
            const isCorrect = calculation.result === gameState.targetNumber;
            
            if (isCorrect) {
                gameState.score += 10;
                document.getElementById('score').textContent = gameState.score;
            }
            
            // 10ë¼ìš´ë“œì¸ì§€ í™•ì¸
            const isLastRound = gameState.currentRound === gameState.totalRounds;
            
            const resultContent = document.getElementById('resultContent');
            resultContent.innerHTML = `
                <div class="space-y-4">
                    <div class="text-2xl font-bold ${isCorrect ? 'text-green-600' : 'text-orange-600'}">
                        ${isCorrect ? 'ì •ë‹µ! ğŸ‰' : 'ì•„ì‰½ì§€ë§Œ, ë‹¤ì‹œ ë„ì „! ğŸ¤”'}
                    </div>
                    
                    <div class="explanation-box p-4">
                        <h4 class="font-semibold text-purple-700 mb-2">ë‚˜ì˜ ê³„ì‚° ê²°ê³¼:</h4>
                        <p class="text-lg font-bold text-blue-600">${calculation.result}</p>
                        <p class="text-sm text-gray-600 mt-1">${calculation.explanation}</p>
                        <p class="text-sm text-gray-600 mt-2">${calculation.formula}</p>
                    </div>
                    
                    <div class="explanation-box p-4">
                        <h4 class="font-semibold text-purple-700 mb-2">ëª©í‘œ ìˆ«ì ${gameState.targetNumber}ëŠ”:</h4>
                        <p class="text-sm text-gray-600">${getTargetExplanation()}</p>
                    </div>
                    
                    ${isLastRound ? 
                        `<button onclick="showGameComplete()" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold mt-4">
                            ê²Œì„ ê²°ê³¼ ë³´ê¸°! ğŸ†
                        </button>` :
                        `<button onclick="nextRound()" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold mt-4">
                            ë‹¤ìŒ ë¼ìš´ë“œ! ğŸ®
                        </button>`
                    }
                </div>
            `;
            
            document.getElementById('resultArea').classList.remove('hidden');
            document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
        }

        function nextRound() {
            // ë¼ìš´ë“œ ì¦ê°€
            gameState.currentRound++;
            
            // ë¼ìš´ë“œ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('currentRound').textContent = `${gameState.currentRound}/${gameState.totalRounds}`;
            
            // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™” (ì ìˆ˜ì™€ ë¼ìš´ë“œëŠ” ìœ ì§€)
            gameState.total = null;
            gameState.count = null;
            gameState.arrangement = null;
            gameState.duplication = null;
            
            // ì´ˆê¸‰ì ëª¨ë“œë©´ ì¤‘ë³µ ë¶ˆê°€ëŠ¥ ë‹¤ì‹œ ì„¤ì •
            if (!gameState.advancedLevel) {
                gameState.duplication = false;
            }
            
            // ë²„íŠ¼ ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
            document.querySelectorAll('.btn-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // ì´ˆê¸‰ì ëª¨ë“œë©´ ì¤‘ë³µ ë¶ˆê°€ëŠ¥ ë²„íŠ¼ ë‹¤ì‹œ ì„ íƒ ìƒíƒœë¡œ
            if (!gameState.advancedLevel) {
                const noDuplicateBtn = document.querySelector('[onclick="selectDuplication(false)"]');
                noDuplicateBtn.classList.add('selected');
            }
            
            // ìºë¦­í„°ì™€ ì„ íƒ ì˜µì…˜ ì´ˆê¸°í™”
            updateCharacters();
            updateCountOptions();
            
            // ê²°ê³¼ ì˜ì—­ ìˆ¨ê¸°ê¸°
            document.getElementById('resultArea').classList.add('hidden');
            
            // ê²°ê³¼ í™•ì¸ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.getElementById('checkBtn').disabled = true;
            document.getElementById('checkBtn').classList.add('opacity-50');
            
            // ìƒˆë¡œìš´ ëª©í‘œ ìˆ«ì ìƒì„±
            generateTarget();
            
            // íƒ€ì´ë¨¸ ì¬ì‹œì‘
            resumeGameTimer();
        }

        function showGameComplete() {
            stopGameTimer();
            const totalTime = Math.floor((Date.now() - gameState.startTime) / 1000);
            const minutes = Math.floor(totalTime / 60);
            const seconds = totalTime % 60;
            const timeString = `${minutes}ë¶„ ${seconds}ì´ˆ`;
            
            const resultContent = document.getElementById('resultContent');
            resultContent.innerHTML = `
                <div class="space-y-6">
                    <div class="text-3xl font-bold text-purple-600">
                        ğŸ‰ ê²Œì„ ì™„ë£Œ! ğŸ‰
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-2xl">
                        <h4 class="text-2xl font-bold text-purple-700 mb-4">ìµœì¢… ê²°ê³¼</h4>
                        <div class="space-y-3 text-lg">
                            <p><span class="font-semibold">ì´ ì ìˆ˜:</span> <span class="text-green-600 font-bold">${gameState.score}ì </span> / 100ì </p>
                            <p><span class="font-semibold">í”Œë ˆì´ ì‹œê°„:</span> <span class="text-blue-600 font-bold">${timeString}</span></p>
                        </div>
                    </div>
                    
                    <div class="explanation-box p-4">
                        <h4 class="font-semibold text-purple-700 mb-2">í‰ê°€:</h4>
                        <p class="text-gray-600">
                            ${gameState.score >= 80 ? 'ğŸ† í›Œë¥­í•´ìš”! ê²½ìš°ì˜ ìˆ˜ ë§ˆìŠ¤í„°!' : 
                              gameState.score >= 60 ? 'ğŸ‘ ì˜í–ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë” ì—°ìŠµí•˜ë©´ ì™„ë²½!' : 
                              gameState.score >= 40 ? 'ğŸ’ª ê´œì°®ì•„ìš”! ë” ì—°ìŠµí•´ì„œ ì‹¤ë ¥ì„ ëŠ˜ë ¤ë³´ì„¸ìš”!' : 
                              'ğŸ“š ì•„ì§ ì—°ìŠµì´ ë” í•„ìš”í•´ìš”. í¬ê¸°í•˜ì§€ ë§ê³  ë‹¤ì‹œ ë„ì „!'}
                        </p>
                    </div>
                    
                    <button onclick="restartGame()" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold mt-4">
                        ìƒˆ ê²Œì„ ì‹œì‘! ğŸ®
                    </button>
                </div>
            `;
            
            document.getElementById('resultArea').classList.remove('hidden');
            document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
        }

        function restartGame() {
            // ê²Œì„ ìƒíƒœ ì™„ì „ ì´ˆê¸°í™”
            stopGameTimer();
            gameState.total = null;
            gameState.count = null;
            gameState.arrangement = null;
            gameState.duplication = null;
            gameState.score = 0;
            gameState.currentRound = 1;
            
            // ì´ˆê¸‰ì ëª¨ë“œë©´ ì¤‘ë³µ ë¶ˆê°€ëŠ¥ ë‹¤ì‹œ ì„¤ì •
            if (!gameState.advancedLevel) {
                gameState.duplication = false;
            }
            
            // í™”ë©´ ì—…ë°ì´íŠ¸
            document.getElementById('score').textContent = '0';
            document.getElementById('currentRound').textContent = '1/10';
            
            // ë²„íŠ¼ ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
            document.querySelectorAll('.btn-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // ì´ˆê¸‰ì ëª¨ë“œë©´ ì¤‘ë³µ ë¶ˆê°€ëŠ¥ ë²„íŠ¼ ë‹¤ì‹œ ì„ íƒ ìƒíƒœë¡œ
            if (!gameState.advancedLevel) {
                const noDuplicateBtn = document.querySelector('[onclick="selectDuplication(false)"]');
                noDuplicateBtn.classList.add('selected');
            }
            
            // ìºë¦­í„°ì™€ ì„ íƒ ì˜µì…˜ ì´ˆê¸°í™”
            updateCharacters();
            updateCountOptions();
            
            // ê²°ê³¼ ì˜ì—­ ìˆ¨ê¸°ê¸°
            document.getElementById('resultArea').classList.add('hidden');
            
            // ê²°ê³¼ í™•ì¸ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.getElementById('checkBtn').disabled = true;
            document.getElementById('checkBtn').classList.add('opacity-50');
            
            // ìƒˆë¡œìš´ ëª©í‘œ ìˆ«ì ìƒì„± ë° íƒ€ì´ë¨¸ ì‹œì‘
            generateTarget();
            startGameTimer();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            document.getElementById('checkBtn').classList.add('opacity-50');
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'95e76aeb9559eab1',t:'MTc1MjM5NTQxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
